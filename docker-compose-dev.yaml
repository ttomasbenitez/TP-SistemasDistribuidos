services:
  rabbitmq:
    container_name: rabbitmq
    image: rabbitmq:3-management
    networks:
    - testing_net
    ports:
    - 5672:5672
    - 15672:15672
    healthcheck:
      test: ["CMD", "rabbitmqctl", "status"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
  
  gateway:
    container_name: gateway
    image: gateway:latest
    environment:
      PORT: 3000
      LOG_LEVEL: INFO
      LISTEN_BACKLOG: '5'
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: gateway
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: results-queue
      OUTPUT_QUEUE_1: stores-queue-1
      OUTPUT_QUEUE_2: stores-queue-2
      OUTPUT_QUEUE_3: menu-items-queue
      OUTPUT_QUEUE_4: users-queue-1
      OUTPUT_QUEUE_5: batches-queue
      OUTPUT_QUEUE_6: users-queue-2
      OUTPUT_EXCHANGE_NAME: results-exchange
      EXCHANGE_NAME: gateway-exchange
    depends_on:
      rabbitmq:
        condition: service_healthy   
    networks:
    - testing_net

  filter-year-1:
    container_name: filter-year-1
    image: worker:latest
    command: "/worker/filter/year.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: filter-year-1
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: batches-queue
      OUTPUT_QUEUE_1: year-filtered-queue-q1-q3
      OUTPUT_QUEUE_Q4_1: year-filtered-queue-q4-1
      OUTPUT_QUEUE_Q4_2: year-filtered-queue-q4-2
      OUTPUT_QUEUE_Q2_1: aggregated-month-input-queue-1
      OUTPUT_QUEUE_Q2_2: aggregated-month-input-queue-2
      OUTPUT_QUEUE_3: year-filtered-queue-q2
      EXCHANGE_NAME: year-filtered-exchange
      EOF_EXCHANGE_NAME: eof-exchange-filter-year
      EOF_SELF_QUEUE: eof-filter-year-1
      EOF_QUEUE_1: eof-filter-year-1
      EOF_QUEUE_2: eof-filter-year-2
      EOF_SERVICE_QUEUE: eof-service-filter-year
      EOF_FINAL_QUEUE: eof-final-filter-year
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway

  filter-year-2:
    container_name: filter-year-2
    image: worker:latest
    command: "/worker/filter/year.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: filter-year-2
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: batches-queue
      OUTPUT_QUEUE_1: year-filtered-queue-q1-q3
      OUTPUT_QUEUE_Q4_1: year-filtered-queue-q4-1
      OUTPUT_QUEUE_Q4_2: year-filtered-queue-q4-2
      OUTPUT_QUEUE_Q2_1: aggregated-month-input-queue-1
      OUTPUT_QUEUE_Q2_2: aggregated-month-input-queue-2
      OUTPUT_QUEUE_3: year-filtered-queue-q2
      EXCHANGE_NAME: year-filtered-exchange
      EOF_EXCHANGE_NAME: eof-exchange-filter-year
      EOF_SELF_QUEUE: eof-filter-year-2
      EOF_QUEUE_1: eof-filter-year-1
      EOF_QUEUE_2: eof-filter-year-2
      EOF_SERVICE_QUEUE: eof-service-filter-year
      EOF_FINAL_QUEUE: eof-final-filter-year
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway

  filter-year-eof-service:
    container_name: filter-year-eof-service
    image: worker:latest
    command: "/worker/eof/eof_service_year.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: filter-year-eof-service
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE: eof-service-filter-year
      OUTPUT_QUEUE: eof-final-filter-year
      LOG_LEVEL: INFO
      EXPECTED_ACKS: 2
    networks:
    - testing_net
    depends_on:
    - gateway

  filter-time-1:
   container_name: filter-time-1
   image: worker:latest
   command: "/worker/filter/time.py"
   environment:
     HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
     CONTAINER_NAME: filter-time-1
     RABBITMQ_HOST: rabbitmq
     INPUT_QUEUE_1: year-filtered-queue-q1-q3
     EOF_SELF_QUEUE: EOF-filter-time-1
     OUTPUT_QUEUE_Q1_1: time-filtered-queue-q1-1
     OUTPUT_QUEUE_Q1_2: time-filtered-queue-q1-2
     OUTPUT_QUEUE_Q1_3: time-filtered-queue-q1-3
     OUTPUT_QUEUE_Q3_1: time-filtered-queue-q3-1
     OUTPUT_QUEUE_Q3_2: time-filtered-queue-q3-2
     EOF_QUEUE_NODO_1: EOF-filter-time-1
     EOF_QUEUE_NODO_2: EOF-filter-time-2
     EXCHANGE_NAME: time-filtered-exchange
     EOF_EXCHANGE_NAME: eof-exchange-filter-time
     EOF_SERVICE_QUEUE: eof-service-filter-time
     LOG_LEVEL: INFO
   networks:
   - testing_net
   depends_on:
   - gateway

  filter-time-2:
   container_name: filter-time-2
   image: worker:latest
   command: "/worker/filter/time.py"
   environment:
     HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
     CONTAINER_NAME: filter-time-2
     RABBITMQ_HOST: rabbitmq
     INPUT_QUEUE_1: year-filtered-queue-q1-q3
     EOF_SELF_QUEUE: EOF-filter-time-2
     OUTPUT_QUEUE_Q1_1: time-filtered-queue-q1-1
     OUTPUT_QUEUE_Q1_2: time-filtered-queue-q1-2
     OUTPUT_QUEUE_Q1_3: time-filtered-queue-q1-3
     OUTPUT_QUEUE_Q3_1: time-filtered-queue-q3-1
     OUTPUT_QUEUE_Q3_2: time-filtered-queue-q3-2
     EOF_QUEUE_NODO_1: EOF-filter-time-1
     EOF_QUEUE_NODO_2: EOF-filter-time-2
     EXCHANGE_NAME: time-filtered-exchange
     EOF_EXCHANGE_NAME: eof-exchange-filter-time
     EOF_SERVICE_QUEUE: eof-service-filter-time
     LOG_LEVEL: INFO
   networks:
   - testing_net
   depends_on:
   - gateway

  filter-time-eof-service:
   container_name: filter-time-eof-service
   image: worker:latest
   command: "/worker/eof/eof_service_time.py"
   environment:
     HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
     CONTAINER_NAME: filter-time-eof-service
     RABBITMQ_HOST: rabbitmq
     INPUT_QUEUE: eof-service-filter-time
     OUTPUT_QUEUE_1: time-filtered-queue-q1-1
     OUTPUT_QUEUE_2: time-filtered-queue-q1-2
     OUTPUT_QUEUE_3: time-filtered-queue-q1-3
     OUTPUT_QUEUE_4: time-filtered-queue-q3-1
     OUTPUT_QUEUE_5: time-filtered-queue-q3-2
     EXCHANGE_NAME: time-filtered-exchange-eof
     LOG_LEVEL: INFO
     EXPECTED_ACKS: 2
   networks:
   - testing_net
   depends_on:
   - gateway

  filter-amount-1:
   container_name: filter-amount-1
   image: worker:latest
   command: "/worker/filter/amount.py"
   environment:
     HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
     CONTAINER_NAME: filter-amount-1
     RABBITMQ_HOST: rabbitmq
     INPUT_QUEUE_1: time-filtered-queue-q1-1
     EXCHANGE_NAME: results-exchange
     TOTAL_SHARDS: 3
     LOG_LEVEL: INFO
   networks:
   - testing_net
   depends_on:
   - gateway

  filter-amount-2:
   container_name: filter-amount-2
   image: worker:latest
   command: "/worker/filter/amount.py"
   environment:
     HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
     CONTAINER_NAME: filter-amount-2
     RABBITMQ_HOST: rabbitmq
     INPUT_QUEUE_1: time-filtered-queue-q1-2
     EXCHANGE_NAME: results-exchange
     TOTAL_SHARDS: 3
     LOG_LEVEL: INFO
   networks:
   - testing_net
   depends_on:
   - gateway

  filter-amount-3:
   container_name: filter-amount-3
   image: worker:latest
   command: "/worker/filter/amount.py"
   environment:
     HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
     CONTAINER_NAME: filter-amount-3
     RABBITMQ_HOST: rabbitmq
     INPUT_QUEUE_1: time-filtered-queue-q1-3
     EXCHANGE_NAME: results-exchange
     TOTAL_SHARDS: 3
     LOG_LEVEL: INFO
   networks:
   - testing_net
   depends_on:
   - gateway

  aggregator-month-1:
    container_name: aggregator-month-1
    image: worker:latest
    command: "/worker/aggregator/month.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-month-1
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-month-input-queue-1
      EOF_SELF_QUEUE: EOF-aggregator-month-1
      OUTPUT_QUEUE_1: aggregated-month-queue-1
      OUTPUT_QUEUE_2: aggregated-month-queue-2
      OUTPUT_QUEUE_3: aggregated-month-queue-3
      EOF_EXCHANGE_NAME: eof-exchange-aggregator-month
      EOF_QUEUE_1: EOF-aggregator-month-1
      EOF_QUEUE_2: EOF-aggregator-month-2
      EOF_SERVICE_QUEUE: eof-service-aggregator-month
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway

  aggregator-month-2:
    container_name: aggregator-month-2
    image: worker:latest
    command: "/worker/aggregator/month.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-month-2
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-month-input-queue-2
      EOF_SELF_QUEUE: EOF-aggregator-month-2
      OUTPUT_QUEUE_1: aggregated-month-queue-1
      OUTPUT_QUEUE_2: aggregated-month-queue-2
      OUTPUT_QUEUE_3: aggregated-month-queue-3
      EOF_EXCHANGE_NAME: eof-exchange-aggregator-month
      EOF_QUEUE_1: EOF-aggregator-month-1
      EOF_QUEUE_2: EOF-aggregator-month-2
      EOF_SERVICE_QUEUE: eof-service-aggregator-month
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway

  aggregator-month-eof-service:
    container_name: aggregator-month-eof-service
    image: worker:latest
    command: "/worker/eof/eof_service_month.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-month-eof-service
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE: eof-service-aggregator-month
      OUTPUT_QUEUE_1: aggregated-month-queue-1
      OUTPUT_QUEUE_2: aggregated-month-queue-2
      OUTPUT_QUEUE_3: aggregated-month-queue-3
      EXPECTED_ACKS: 2
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway

  aggregator-quantity-profit-1:
    container_name: aggregator-quantity-profit-1
    image: worker:latest
    command: "/worker/aggregator/max_quantity_profit.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-quantity-profit-1
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-month-queue-1
      OUTPUT_QUEUE_1: products-results-queue
      EXPECTED_EOFS: 2
      STORAGE_DIR: ./data/aggregator-quantity-profit-1
      LOG_LEVEL: INFO
      NODE_ID: 1
    networks:
    - testing_net
    depends_on:
    - gateway
    volumes:
      - ./data/aggregator-quantity-profit-1:/data/aggregator-quantity-profit-1

  aggregator-quantity-profit-2:
    container_name: aggregator-quantity-profit-2
    image: worker:latest
    command: "/worker/aggregator/max_quantity_profit.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-quantity-profit-2
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-month-queue-2
      OUTPUT_QUEUE_1: products-results-queue
      EXPECTED_EOFS: 2
      STORAGE_DIR: ./data/aggregator-quantity-profit-2
      LOG_LEVEL: INFO
      NODE_ID: 2
    networks:
    - testing_net
    depends_on:
    - gateway
    volumes:
      - ./data/aggregator-quantity-profit-2:/data/aggregator-quantity-profit-2

  aggregator-quantity-profit-3:
    container_name: aggregator-quantity-profit-3
    image: worker:latest
    command: "/worker/aggregator/max_quantity_profit.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-quantity-profit-3
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-month-queue-3
      OUTPUT_QUEUE_1: products-results-queue
      EXPECTED_EOFS: 2
      STORAGE_DIR: ./data/aggregator-quantity-profit-3
      LOG_LEVEL: INFO
      NODE_ID: 3
    networks:
    - testing_net
    depends_on:
    - gateway
    volumes:
      - ./data/aggregator-quantity-profit-3:/data/aggregator-quantity-profit-3

  joiner-menu-items:
    container_name: joiner-menu-items
    image: worker:latest
    command: "/worker/joiner/menu_items.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: joiner-menu-items
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: products-results-queue
      INPUT_QUEUE_2: menu-items-queue
      OUTPUT_EXCHANGE: results-exchange
      STORAGE_DIR: ./data/join_menu_items
      EXPECTED_EOFS: 4
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - aggregator-quantity-profit-1
    - aggregator-quantity-profit-2
    - aggregator-quantity-profit-3

  aggregator-semester-1:
    container_name: aggregator-semester-1
    image: worker:latest
    command: "/worker/aggregator/semester_aggregator.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-semester-1
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-store-q3-queue-1
      OUTPUT_QUEUE_1: aggregated-semester-queue
      LOG_LEVEL: INFO
      EXPECTED_ACKS: 2
    networks:
    - testing_net
    depends_on:
    - gateway

  aggregator-semester-2:
    container_name: aggregator-semester-2
    image: worker:latest
    command: "/worker/aggregator/semester_aggregator.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-semester-2
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-store-q3-queue-2
      OUTPUT_QUEUE_1: aggregated-semester-queue
      LOG_LEVEL: INFO
      EXPECTED_ACKS: 2
    networks:
    - testing_net
    depends_on:
    - gateway

  aggregator-store-q3-1:
    container_name: aggregator-store-q3-1
    image: worker:latest
    command: "/worker/aggregator/store_aggregator.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-store-q3-1
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: time-filtered-queue-q3-1
      OUTPUT_EXCHANGE: aggregated-store-q3-exchange
      OUTPUT_QUEUE_1: aggregated-store-q3-queue-1
      OUTPUT_QUEUE_2: aggregated-store-q3-queue-2
      NODE_ID: 1
      TOTAL_SHARDS: 2
      LOG_LEVEL: INFO
      SHARDING_KEY: store
    networks:
    - testing_net
    depends_on:
    - gateway   

  aggregator-store-q3-2:
    container_name: aggregator-store-q3-2
    image: worker:latest
    command: "/worker/aggregator/store_aggregator.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-store-q3-2
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: time-filtered-queue-q3-2
      OUTPUT_EXCHANGE: aggregated-store-q3-exchange
      OUTPUT_QUEUE_1: aggregated-store-q3-queue-1
      OUTPUT_QUEUE_2: aggregated-store-q3-queue-2
      NODE_ID: 2
      TOTAL_SHARDS: 2
      LOG_LEVEL: INFO
      SHARDING_KEY: store
    networks:
    - testing_net
    depends_on:
    - gateway

  joiner-stores-q3:
    container_name: joiner-stores-q3
    image: worker:latest
    command: "/worker/joiner/q3_stores_joiner.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: joiner-stores-q3
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-semester-queue
      INPUT_QUEUE_2: stores-queue-1
      OUTPUT_EXCHANGE_NAME: results-exchange
      STORAGE_DIR: ./data/join_stores_q3
      LOG_LEVEL: INFO
      EXPECTED_ACKS: 2
    networks:
    - testing_net
    depends_on:
    - gateway
    volumes:
      - ./data/join_stores_q3:/data/join_stores_q3

  aggregator-store-q4-1:
    container_name: aggregator-store-q4-1
    image: worker:latest
    command: "/worker/aggregator/store_aggregator.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-store-q4-1
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: year-filtered-queue-q4-1
      OUTPUT_EXCHANGE: aggregated-store-q4-exchange
      OUTPUT_QUEUE_1: aggregated-store-q4-queue-1
      OUTPUT_QUEUE_2: aggregated-store-q4-queue-2
      # EOF_SERVICE_QUEUE: eof-service-aggregator-store-q4
      NODE_ID: 1
      TOTAL_SHARDS: 2
      LOG_LEVEL: INFO
      SHARDING_KEY: semester
    networks:
    - testing_net
    depends_on:
    - gateway   

  aggregator-store-q4-2:
    container_name: aggregator-store-q4-2
    image: worker:latest
    command: "/worker/aggregator/store_aggregator.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: aggregator-store-q4-2
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: year-filtered-queue-q4-2
      OUTPUT_EXCHANGE: aggregated-store-q4-exchange
      OUTPUT_QUEUE_1: aggregated-store-q4-queue-1
      OUTPUT_QUEUE_2: aggregated-store-q4-queue-2
      # EOF_SERVICE_QUEUE: eof-service-aggregator-store-q4
      NODE_ID: 2
      TOTAL_SHARDS: 2
      LOG_LEVEL: INFO
      SHARDING_KEY: semester
    networks:
    - testing_net
    depends_on:
    - gateway   

  # aggregator-store-q4-eof-service:
  #   container_name: aggregator-store-q4-eof-service
  #   image: worker:latest
  #   command: "/worker/eof/eof_service_aggregator_store.py"
  #   environment:
  #     HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
  #     CONTAINER_NAME: aggregator-store-q4-eof-service
  #     RABBITMQ_HOST: rabbitmq
  #     INPUT_QUEUE: eof-service-aggregator-store-q4
  #     OUTPUT_QUEUE: aggregated-store-q4-queue
  #     LOG_LEVEL: INFO
  #     EXPECTED_ACKS: 2
  #   networks:
  #   - testing_net
  #   depends_on:
  #   - gateway

  top-three-clients-1:
    container_name: top-three-clients-1
    image: worker:latest
    command: "/worker/joiner/top_three_clients.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: top-three-clients-1
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-store-q4-queue-1
      INPUT_QUEUE_2: users-queue-1
      OUTPUT_QUEUE_1: top-clients-queue
      STORAGE_DIR: ./data/top-three-clients
      NODE_ID: 1
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway
    volumes:
      - ./data/top-three-clients:/data/top-three-clients-1

  top-three-clients-2:
    container_name: top-three-clients-2
    image: worker:latest
    command: "/worker/joiner/top_three_clients.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: top-three-clients-2
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: aggregated-store-q4-queue-2
      INPUT_QUEUE_2: users-queue-2
      OUTPUT_QUEUE_1: top-clients-queue
      STORAGE_DIR: ./data/top-three-clients
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway
    volumes:
      - ./data/top-three-clients:/data/top-three-clients-2

  join-stores-q4:
    container_name: join-stores-q4
    image: worker:latest
    command: "/worker/joiner/join_stores_q4.py"
    environment:
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: join-stores-q4
      RABBITMQ_HOST: rabbitmq
      INPUT_QUEUE_1: top-clients-queue
      INPUT_QUEUE_2: stores-queue-2
      OUTPUT_EXCHANGE_NAME: results-exchange
      STORAGE_DIR: ./data/join_stores_q4
      LOG_LEVEL: INFO
    networks:
    - testing_net
    depends_on:
    - gateway
    volumes:
      - ./data/join_stores_q4:/data/join_stores_q4

  client_1:
    container_name: client_1
    image: client:latest
    environment:
      GATEWAY_HOST: gateway
      GATEWAY_PORT: 3000
      LOG_LEVEL: INFO
      STORES_FOLDER_PATH: data/stores/
      MENU_ITEMS_FOLDER_PATH: data/menu_items/
      USERS_FOLDER_PATH: data/users/
      TRANSACTIONS_FOLDER_PATH: data/transactions/
      TRANSACTION_ITEMS_FOLDER_PATH: data/transaction_items/
      MAX_BATCH_SIZE: 250000
    depends_on:
      - gateway
    networks:
      - testing_net
    volumes:
      - ./client/data/menu_items/:/data/menu_items/
      - ./client/data/stores/:/data/stores/
      - ./client/data/users/:/data/users/
      - ./client/data/transactions/:/data/transactions/
      - ./client/data/transaction_items/:/data/transaction_items/
      - ./client/storage/:/storage/

  client_2:
    container_name: client_2
    image: client:latest
    environment:
      GATEWAY_HOST: gateway
      GATEWAY_PORT: 3000
      LOG_LEVEL: INFO
      STORES_FOLDER_PATH: data/stores/
      MENU_ITEMS_FOLDER_PATH: data/menu_items/
      USERS_FOLDER_PATH: data/users/
      TRANSACTIONS_FOLDER_PATH: data/transactions/
      TRANSACTION_ITEMS_FOLDER_PATH: data/transaction_items/
      MAX_BATCH_SIZE: 300000
    depends_on:
      - gateway
    networks:
      - testing_net
    volumes:
      - ./client/data/menu_items/:/data/menu_items/
      - ./client/data/stores/:/data/stores/
      - ./client/data/users/:/data/users/
      - ./client/data/transactions/:/data/transactions/
      - ./client/data/transaction_items/:/data/transaction_items/
      - ./client/storage/:/storage/

  # client_3:
  #   container_name: client_3
  #   image: client:latest
  #   environment:
  #     GATEWAY_HOST: gateway
  #     GATEWAY_PORT: 3000
  #     LOG_LEVEL: INFO
  #     STORES_FOLDER_PATH: data/stores/
  #     MENU_ITEMS_FOLDER_PATH: data/menu_items/
  #     USERS_FOLDER_PATH: data/users/
  #     TRANSACTIONS_FOLDER_PATH: data/transactions/
  #     TRANSACTION_ITEMS_FOLDER_PATH: data/transaction_items/
  #     MAX_BATCH_SIZE: 50000
  #   depends_on:
  #     - gateway
  #   networks:
  #     - testing_net
  #   volumes:
  #     - ./client/data/menu_items/:/data/menu_items/
  #     - ./client/data/stores/:/data/stores/
  #     - ./client/data/users/:/data/users/
  #     - ./client/data/transactions/:/data/transactions/
  #     - ./client/data/transaction_items/:/data/transaction_items/
  #     - ./client/storage/:/storage/

  health-monitor-1:
    container_name: health-monitor-1
    image: health-monitor:latest
    build:
      context: .
      dockerfile: health_monitor/Dockerfile
    environment:
      NODE_NAME: health-monitor-1
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: health-monitor-1
      LOG_LEVEL: DEBUG
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - testing_net

  health-monitor-2:
    container_name: health-monitor-2
    image: health-monitor:latest
    environment:
      NODE_NAME: health-monitor-2
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: health-monitor-2
      LOG_LEVEL: DEBUG
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - testing_net

  health-monitor-3:
    container_name: health-monitor-3
    image: health-monitor:latest
    environment:
      NODE_NAME: health-monitor-3
      HEALTH_MONITORS: health-monitor-1,health-monitor-2,health-monitor-3
      CONTAINER_NAME: health-monitor-3
      LOG_LEVEL: DEBUG
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - testing_net

networks:
  testing_net:
    ipam:
      driver: default
      config:
        - subnet: 172.25.125.0/24